function getUrlPara(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):null}function getCurrentScene(e,t){var i=window.location.host;if("number"!=typeof t&&t.indexOf(",")>-1){var a=t.split(",");t=0==a[a.length-1]||""==a[a.length-1]?a[a.length-2]:a[a.length-1]}return"text"==e?"//"+i+"/user/active/addActive?qrtype=text&i="+t+"&t=text&p=1":"imgtext"==e?"//"+i+"/user/active/addActive?qrtype=imgtext&i="+t+"&t=imgtext&p=1":"pro"==e?"//"+i+"/user/active/proadd?qrtype=pro&i="+t+"&t=all&p=1&code_type=0":"record"==e?"//"+BIZ_DOMAIN+"/Rec/add_record?type=user_blank":"product"==e?"//"+BIZ_DOMAIN+"/productV2/create_product?cls_id="+t+"&title=未命名":"//"+i+"/user/active/addActive?qrtype=imgtext&i="+t+"&t=imgtext&p=1"}function isArray(e){return e?Array.isArray?Array.isArray(e):"[object Array]"==Object.prototype.toString.call(e):!1}if("undefined"==typeof account)var account=null;var iTime,_tabActiveIdToNameMap={100000:"all",18:"fangyi",5:"xuanchuanjieshao",1:"shangpinzhanshi",2:"jianzhushigong",10:"zichanshebei",9:"xinxidengji",100001:"urlVcard"},_tabActiveNameToIdMap={all:"100000",fangyi:"18",xuanchuanjieshao:"5",shangpinzhanshi:"1",jianzhushigong:"2",zichanshebei:"10",xinxidengji:"9",urlVcard:"100001"},_tabOldActiveIdToNameMap={7:"qiyetongyong",1:"jainzhushigong",4:"lvyouye",2:"jiaoyutushu",3:"pifalingshou",6:"zhengfujigou"},_tabOldActiveNameToIdMap={qiyetongyong:"7",jainzhushigong:"1",lvyouye:"4",jiaoyutushu:"2",pifalingshou:"3",zhengfujigou:"6"},ActiveNewCode=new Vue({el:"#activeNewCode",data:{account:account,cases:[],sceneList:[],orgTypes:[],buildBlankSceneItem:null,currentTabIndex:-1,currentIndustryIndex:-1,currentTagId:0,cfrom:getUrlPara("cfrom")||"1",loading:!1,previewShow:null,submiting:!1,qrblank:"",submitingId:null,origin:null,minHeight:0,showDiseaseBannerId:1e4,fixedMinHeight:window.innerHeight-60,isFixed:!1,editionId:editionId,qrType:getUrlPara("type")||staticQrType||"nencao",tabList:[{type:"nencao",title:"活码"},{type:"batch",title:"批量活码"},{type:"urlCode",title:"网址活码"},{type:"vcard",title:"名片活码"},{type:"imgtext",title:"旧版活码"}],vcards:[{index:15,text:"企业名片",url:"//"+CONSOLE_DOMAIN+"/company/card",icon:"anticon-mingpian",desc:["批量制作成员名片","后台统一管理"],needLogin:!0},{index:16,text:"个人名片",desc:["制作个人名片","微信小程序管理"],url:"//"+CLI_DOMAIN+"/vcard",icon:"anticon-user",needLogin:!1}]},created:function(){switch(this.qrType){case"nencao":this.getScene("1");break;case"batch":this.getScene("6");break;case"imgtext":this.getTabList();break;case"product":this.getTabList();break;case"record":this.getScene("7");break;default:this.getScene("1")}},mounted:function(){this.$nextTick(function(){$('[data-toggle="popover"]').popover({placement:"bottom",template:'<div class="popover price-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>',trigger:"manual",html:!0,animation:!1}).on("mouseenter",function(){var e=this;$(".popover").remove(),$(this).popover("show"),$(".popover").on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},300)}),$(window).scroll(this.handleScroll.bind(this))}),this.pageLog()},updated:function(){this.loading||$('[data-toggle="tooltip"]').tooltip({delay:{hide:2e3}})},computed:{solutionHidden:function(){return"product"===this.qrType&&(!this.account||4!=this.editionId)},solutionShow:function(){return"product"===this.qrType&&4==this.editionId},currentTypeText:function(){switch(this.qrType){case"nencao":return"活码";case"batch":return"批量二维码";case"imgtext":return"旧版活码";case"urlCode":return"网址活码";case"vcard":return"名片码";case"product":return"解决方案";case"record":return"记录码"}},pageTitle:function(){var e={nencao:"选择模板，开始创建活码",batch:"创建模板，导入Excel数据，批量生成活码",imgtext:"旧版活码模板",urlCode:"选择模板，创建你的二维码",vcard:"选择模板，创建你的二维码",product:"选择模板，创建你的二维码",record:"选择模板，创建带记录功能的活码"};return e[this.qrType]||"选择模板，创建你的二维码"},tinyList:function(){var e="from=center";this.account||(e="from=front");var t=[{index:6,type:"text",text:"文本码",url:"2"==getUrlPara("cfrom")?"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=text&i=1&t=text&p=1&from=center":"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=text&i=1&t=text&p=1&add_from=21&"+e},{index:7,type:"imgtext",text:"图文码",url:"2"==getUrlPara("cfrom")?"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=imgtext&i=1&t=imgtext&p=1&from=center":"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=imgtext&i=1&t=imgtext&p=1&add_from=21&"+e},{index:8,type:"file",text:"文件码",url:"2"==getUrlPara("cfrom")?"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=file&i=1&t=file&p=1&from=center":"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=file&i=1&t=file&p=1&add_from=21&"+e},{index:12,type:"pro",text:"商品码",url:"2"==getUrlPara("cfrom")?"//"+CLI_DOMAIN+"/pro/add?from=center&t=pro&i=1":"//"+CLI_DOMAIN+"/pro/add?from=front&t=pro&i=1&add_from=24"},{index:17,text:"名片码",url:"//"+BIZ_DOMAIN+"/vcard/create",icon:"fa-user",type:"fa-user",needLogin:!0},{index:11,type:"record",text:"记录码",url:"//"+CLI_DOMAIN+"/record"},{index:13,type:"origin",text:"溯源码",url:"//"+CLI_DOMAIN+"/origin/home"},{index:14,type:"company",text:"企业码",url:"//"+BIZ_DOMAIN+"/create/10",needLogin:!0}];return t},urlCodes:function(){var e="from=center";this.account||(e="from=front");var t=[{index:9,type:"jump",icon:"anticon-wangzhiyuming",text:"网址跳转码",desc:["适合单个网址","扫码直接跳转"],url:"2"==getUrlPara("cfrom")?"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=jump&i=1&t=jump&p=1&from=center":"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=jump&i=1&t=jump&p=1&add_from=21&"+e},{index:10,type:"url",icon:"anticon-difangwangzhi-copy",text:"网址导航码",desc:["适合多个网址","导航点击跳转"],url:"2"==getUrlPara("cfrom")?"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=url&i=1&t=url&p=1&from=center":"//"+CLI_DOMAIN+"/user/active/addActive?qrtype=url&i=1&t=url&p=1&add_from=21&"+e}];return t}},methods:{openDiseaseTip:function(){this.statisticsDataWithComment(1,103),window.open("//cli.im/case/detail/1467")},setIndustryIndex:function(e,t){if(iTime&&clearTimeout(iTime),t){var i=document.getElementById(t),a=i.getBoundingClientRect(),n=a.top,r=$("html").scrollTop();$("html, body").animate({scrollTop:r+n-90},400)}switch(e){case 1:this.statisticsDataWithComment(1,107,"疾病防控 ———— 物业公司");break;case 2:this.statisticsDataWithComment(1,108,"疾病防控 ———— 医院/药店");break;case 3:this.statisticsDataWithComment(1,109,"疾病防控 ———— 企事业单位");break;case 4:this.statisticsDataWithComment(1,110,"疾病防控 ———— 街道社区");break;case 5:this.statisticsDataWithComment(1,111,"疾病防控 ———— 学校");break;case 6:this.statisticsDataWithComment(1,112,"疾病防控 ———— 建筑工地")}this.currentIndustryIndex=e;var o=this;iTime=setTimeout(function(){o.currentIndustryIndex=-1},1500)},setOrgTypes:function(e){if(e){for(var t=e.btn,i={wuye:{},medical:{},company:{},government:{},school:{},building:{}},a=0;a<t.length;a++){var n=t[a];1!=n.add_new_code_hide&&(n.industry_ids.indexOf("1")>-1&&(i.wuye.industryName="物业公司",i.wuye.industryId=1,isArray(i.wuye.btns)?i.wuye.btns.push(n):i.wuye.btns=[n]),n.industry_ids.indexOf("2")>-1&&(i.medical.industryName="医院/药店",i.medical.industryId=2,isArray(i.medical.btns)?i.medical.btns.push(n):i.medical.btns=[n]),n.industry_ids.indexOf("3")>-1&&(i.company.industryName="企业/厂区",i.company.industryId=3,isArray(i.company.btns)?i.company.btns.push(n):i.company.btns=[n]),n.industry_ids.indexOf("4")>-1&&(i.government.industryName="街道社区",i.government.industryId=4,isArray(i.government.btns)?i.government.btns.push(n):i.government.btns=[n]),n.industry_ids.indexOf("5")>-1&&(i.school.industryName="学校",i.school.industryId=5,isArray(i.school.btns)?i.school.btns.push(n):i.school.btns=[n]),n.industry_ids.indexOf("6")>-1&&(i.building.industryName="建筑工地",i.building.industryId=6,isArray(i.building.btns)?i.building.btns.push(n):i.building.btns=[n]))}i.wuye.btns?i.wuye.btns.sort(this.sortNumber):i.medical.btns?i.medical.btns.sort(this.sortNumber):i.company.btns?i.company.btns.sort(this.sortNumber):i.government.btns?i.government.btns.sort(this.sortNumber):i.school.btns?i.school.btns.sort(this.sortNumber):i.building.btns&&i.building.btns.sort(this.sortNumber),this.orgTypes=i}},handleScroll:function(){var e=$("#category"),t=$("#category_wrap"),i=$("#fixed_content");if(e&&e.length){var a=e[0].getBoundingClientRect(),n=t[0].getBoundingClientRect().top;0>n?(t.css({height:a.height+"px"}),i.css({position:"fixed",left:0,top:0,background:"#fff",width:"100%","z-index":1002}),e.addClass("fixed-btn"),this.isFixed=!0):(e.removeClass("fixed-btn"),i.css({position:"static",left:0,top:0,background:"none"}),this.isFixed=!1)}},getTabList:function(){var e=this;this.loading=!0,$.ajax({type:"POST",url:"/Apis/QrcodeCase/get_list_pic",dataType:"json",data:{type:e.qrType},success:function(t){if(e.loading=!1,1==t.status){if(t.data.length){e.currentTabIndex=0,e.cases=t.data,e.setOldTabUrl(e.cases);var i=Math.max.apply(null,t.data.map(function(e){var t=e.data.length/5;return Math.ceil(t)}));e.$nextTick(function(){e.minHeight=327*i});var a=getUrlPara("tabName");a&&e.selectOldTab(e.cases,a)}}else alert(t.info,"danger")},error:function(){e.loading=!1}})},sortNumber:function(e,t){return parseInt(e.all_sort,10)-parseInt(t.all_sort,10)},getBuildBlankSceneItem:function(e){var t=this;Object(e)instanceof Array&&e.some(function(e){return"从空白创建模板"===e.title?(t.buildBlankSceneItem=e,!0):!1})},setTabUrl:function(e,t){if(0==e.length)return[];for(var i=0;i<e.length;i++){var a=e[i];if(6==t)if(getUrlPara("navigation")){var n="/user/active/newcode?navigation="+getUrlPara("navigation")+"&type=batch&tabName="+_tabActiveIdToNameMap[a.id];a.tabUrl=this.setTabUrlDifferent(n,a.id)}else{var n="/user/active/newcode?type=batch&tabName="+_tabActiveIdToNameMap[a.id];a.tabUrl=this.setTabUrlDifferent(n,a.id)}else if(7==t)if(getUrlPara("navigation")){var n="/user/active/newcode?navigation="+getUrlPara("navigation")+"&type=record&tabName="+_tabActiveIdToNameMap[a.id];a.tabUrl=this.setTabUrlDifferent(n,a.id)}else{var n="/user/active/newcode?type=record&tabName="+_tabActiveIdToNameMap[a.id];a.tabUrl=this.setTabUrlDifferent(n,a.id)}}},setOldTabUrl:function(e){for(var t=0;t<e.length;t++){var i=e[t];i.tabUrl="/user/active/newcode?cfrom=1&type=imgtext&tabName="+_tabOldActiveIdToNameMap[i.id]}},setTabUrlDifferent:function(e,t){return 18==t?"/user/active/yiqing":e},setRecordOrgTypes:function(e){for(var t=0;t<e.length;t++){var i=e[t];"18"==i.id&&this.setOrgTypes(i)}},notShowInActiveCode:function(e){if(0==e.length)return[];for(var t=e.concat(),i=[],a=0;a<t.length;a++){if(getUrlPara("navigation")){var n="/user/active/newcode?navigation="+getUrlPara("navigation")+"&tabName="+_tabActiveIdToNameMap[t[a].id];t[a].tabUrl=this.setTabUrlDifferent(n,t[a].id)}else{var n="/user/active/newcode?tabName="+_tabActiveIdToNameMap[t[a].id];t[a].tabUrl=this.setTabUrlDifferent(n,t[a].id)}var r=t[a].btn;i[a]=t[a],"18"==i[a].id&&this.setOrgTypes(i[a]);var o=[];if(r&&r.length>0)for(var c=0;c<r.length;c++)1!=r[c].add_new_code_hide&&o.push(r[c]);i[a].btn=o}return i},findIndexById:function(e,t){for(var i=0;i<e.length;i++)if(e[i]&&e[i].id===t)return i;return 0},_is_net:function(){var e=window.location.href;return e.indexOf("cli.me")>-1||e.indexOf("cliim.net")>-1?!0:e.indexOf("cliim.com")>-1||e.indexOf("cli.im")>-1?!1:!1},getScene:function(e){var t=this,i=setTimeout(function(){t.loading=!0},500);$.ajax({type:"GET",url:"/case/sceneBtnApi",dataType:"json",data:{type:e||"1"},success:function(a){if(clearTimeout(i),t.loading=!1,1==a.status){if(a.data.length){switch(e){case"6":t.sceneList=a.data.map(function(e){var i=e.btn;return t.getBuildBlankSceneItem(i),e.btn=i.filter(function(e){return"从空白创建模板"!==e.title}),e}),t.setTabUrl(t.sceneList,6);break;case"7":t.sceneList=a.data,t.setTabUrl(t.sceneList,7),t.setRecordOrgTypes(t.sceneList);break;default:t.sceneList=t.notShowInActiveCode(a.data)}var n="/user/active/newcode?tabName=all",r="/user/active/newcode?tabName=urlVcard";6==e?(n="/user/active/newcode?type=batch&tabName=all",r="/user/active/newcode?type=batch&tabName=urlVcard"):7==e&&(n="/user/active/newcode?type=record&tabName=all",r="/user/active/newcode?type=record&tabName=urlVcard"),getUrlPara("navigation")&&(n=n+"&navigation="+getUrlPara("navigation"),r=r+"&navigation="+getUrlPara("navigation"));var o=t.sceneList.reduce(function(e,t){var i=t.btn||[];return e.concat(i)},[]).sort(t.sortNumber);t.sceneList=[{categroy_name:"全部模板",id:1e5,tabUrl:n,btn:o}].concat(t.sceneList.filter(function(e){return e.btn&&e.btn.length})),"1"===e&&t.sceneList.push({categroy_name:"网址和名片",tabUrl:r,id:100001});var c=getUrlPara("classifyid"),s=getUrlPara("tab_type"),d={building:"2",electricity:"10"};d[s]&&(c=d[s]),t.currentTabIndex=t.findIndexById(t.sceneList,c);var l=getUrlPara("guide"),u=getUrlPara("tabName"),m="disease";t.sceneList=t.shakingHideList(t.sceneList),(l&&"indexBanner"==l||u)&&(u&&(m="tab"),t.selectTab(t.sceneList,m,u))}}else alert(a.info,"danger")},error:function(){clearTimeout(i),t.loading=!1}})},shakingHideList:function(e){if(0==e.length)return[];for(var t=e.concat(),i=[],a=0;a<t.length;a++){var n=t[a].btn;i[a]=t[a];var r=[];if(n&&n.length>0){for(var o=0;o<n.length;o++)1!=n[o].add_new_code_hide&&r.push(n[o]);i[a].btn=r}}return i},selectTab:function(e,t,i){var a=1e5;i&&(a=parseInt(_tabActiveNameToIdMap[i],10));var n=-1,r=0,o={};"tab"==t?n=a:"disease"==t&&(n=this._is_net()?5:18);for(var c=0;c<e.length;c++){var s=e[c];s.id==n&&(r=c,o=s)}this.activeTab(r,o)},selectOldTab:function(e,t){var i=7;t&&(i=parseInt(_tabOldActiveNameToIdMap[t],10));for(var a=i,n=-1,r={},o=0;o<e.length;o++){var c=e[o];c.id==a&&(n=o,r=c)}this.activeTab(n,r)},setType:function(e){this.currentTabIndex=-1,this.qrType=e.type;var t=getUrlPara("cfrom")||"1",i=getUrlPara("returnType"),a=getUrlPara("navigation")||"0",n=window.location.pathname+"?cfrom="+t+"&type="+e.type+"&navigation="+a;switch(i&&(n+="&returnType="+i),history.replaceState({},document.title,n),e.type){case"nencao":this.getScene("1"),this.statisticsDataWithComment(92,1,"新版活码");break;case"imgtext":this.getTabList(),this.statisticsDataWithComment(92,2,"其他活码");break;case"product":this.getTabList(),this.statisticsDataWithComment(92,5,"解决方案");break;case"batch":this.getScene("6"),this.statisticsDataWithComment(92,3,"批量二维码");break;case"vcard":this.getScene("6"),this.statisticsDataWithComment(92,4,"名片码")}this.pageLog()},changeCodeType:function(e){var t={old:{type:"imgtext",title:"旧版活码"},"new":{type:"nencao",title:"活码"}},i=getUrlPara("page_from");if("new"===e&&"console"===i)return void(window.location.href=document.referrer||"//"+CONSOLE_DOMAIN+"/active/activecode/addcode");var a=t[e];a&&this.setType(a)},activeTab:function(e,t,i){if(i&&(i.preventDefault(),18==t.id&&"batch"!=this.qrType))return window.location.href="/user/active/yiqing?pageFrom=addNewCode",!1;this.currentTabIndex=e;var a=document.getElementById("category_wrap");if(this.isFixed){var n=a.getBoundingClientRect().y+window.scrollY+1;window.scroll(0,n)}if(t&&(this.statisticsDataWithComment(162,t.id,t.categroy_name),this.showDiseaseBannerId=18==t.id||"疫情防控专题"==t.categroy_name||"防疫"==t.categroy_name?18:t.id),"imgtext"==this.qrType){var r="qiyetongyong",o=t.id;o&&_tabOldActiveIdToNameMap[o]&&(r=_tabOldActiveIdToNameMap[o])}else{var r="all",o=t.id;o&&_tabActiveIdToNameMap[o]&&(r=_tabActiveIdToNameMap[o])}var c=window.location.search;c=c?c.indexOf("tabName=")>-1?c.replace("tabName="+getUrlPara("tabName"),"tabName="+r):c+"&tabName="+r:"?tabName="+r,history.replaceState({},document.title,window.location.pathname+c)},activePreviewShow:function(e,t,i,a){a&&(this.currentTagId=a);var n=94;"record"===this.qrType?n=157:2==this.cfrom&&(n=168),this.statisticsDataWithComment(n,e.id,this.currentTypeText+"_"+e.title),"product"===this.qrType?seajs.use("//"+STATIC_SERVICE+"/js/preview.js?t=20170420",function(t){t.mobile_preview(e.preview_img_url_http,e.preview_img_url_https,"","yes")}):(t&&(e.scene_id=t,e.index_title=i),$("body").addClass("caseHiddenScroll"),this.previewShow=e,$(".preview_doc_show_loading").show(),this.$nextTick(function(){$("#previewShowImg").css("visibility","hidden");var t=new Image,i=$(window).width(),a=0;t.onload=function(){$(".preview_doc_show_loading").hide(),900==this.width||1800==this.width?(a=703,$(".preview_doc_show_main").css("width","703px").css("margin-left","-187px")):1200==this.width||2400==this.width?(a=1200,$(".preview_doc_show_main").css("width","1200px").css("margin-left","-487px"),1480>=i&&$(".preview_doc_show_main").css("margin-left","-600px")):(a=375,$(".preview_doc_show_main").css("width","375px").css("margin-left","-187px")),a>=i&&$(".preview_doc_show_main").css({width:i+"px","margin-left":-i/2+"px"}),$("#previewShowImg").attr("src",e.preview_img_long),$("#previewShowImg").css("visibility","visible")},t.src=e.preview_img_long}))},resetPreviewShow:function(){$("body").removeClass("caseHiddenScroll"),this.currentTagId=0,this.previewShow=null},confirmUse:function(e,t,i,a,n){var r=0;n&&(r=n);var o=this,c=[95,93];"record"===this.qrType?c=[158,163]:2==this.cfrom&&(c=[169,167]),this.statisticsDataWithComment(this.previewShow?c[0]:c[1],e.id,this.currentTypeText+"_"+e.title),i?(this.submiting=!0,this.copyCaseV2(e,t,i,a,r)):"undefined"!=typeof account&&account?this.copyCase(e,t):seajs.use("//"+STATIC_SERVICE+"/js/login_plugin.js?v=20191120",function(i){i.login_plugin("login",0,function(){o.submiting=!0,$("#iframe").hide(),$("#login_join",window.parent.document).hide(),$("#close_login",window.parent.document).hide(),$("body",window.parent.document).removeClass("modal-active"),$("#login",window.parent.document).hide(),$("#myqr_out",window.parent.document).show(),setTimeout(function(){o.copyCase(e,t)},0)})})},isOpenNewWin:function(){var e;return account&&(e=window.open("about:blank"),e&&(e.document.write("创建中..."),e.document.title="创建中...")),e},copyCase:function(e,t){var i=this;this.submitingId=e.id,this.origin=t;var a=getUrlPara("cfrom"),n=getUrlPara("returnType");if(2!==parseInt(a,10)&&"record"!==n&&"batch"!==n&&"editdesc"!==n)var r=this.isOpenNewWin();$.ajax({type:"GET",url:"/apis/QrcodeCase/copy",data:{case_id:e?e.id:i.previewShow.id,from_id:5,cls_id:"1",type:i.qrType,front_add:22},dataType:"json",success:function(e){1==e.status?(r&&"2"!==a&&"record"!==n&&"batch"!==n&&"editdesc"!==n?r.location.href=e.data.edit_link:window.location.href=e.data.edit_link.indexOf("?")>-1?e.data.edit_link+"&from=center":e.data.edit_link+"?from=center",i.submitingId=null,i.origin=null,i.submiting=!1):(i.submitingId=null,i.origin=null,alert(e.info,"danger"),i.submiting=!1)},error:function(){i.submitingId=null,i.origin=null,alert("网络错误，请稍后重试","danger"),i.submiting=!1}})},copyCaseV2:function(e,t,i,a,n){var r=this;this.submitingId=e.id,this.origin=t;var o=getUrlPara("type"),c=getUrlPara("cfrom"),s=getUrlPara("clickfrom"),d=0,l=getUrlPara("returnType");if("2"==c?(d=65,"nencao"==o?d=65:"batch"==o&&(d="blankBuild"!=a?67:66)):"products"===s?d=68:"index"===s?"batch"===o?d="blankBuild"!=a?35:33:"record"===o&&(d=getUrlPara("create_from")||32):"editdesc"===s?d=85:(d=24,"nencao"==o?d=24:"batch"==o&&(d="blankBuild"!=a?25:23),("building"==getUrlPara("tab_type")||"electricity"==getUrlPara("tab_type"))&&(d=getUrlPara("create_from")||24),56===parseInt(getUrlPara("create_from"),10)&&(d=82)),"2"!==c&&"record"!==l&&"batch"!==l&&"editdesc"!==l&&"products"!==l)var u=this.isOpenNewWin();$.ajax({type:"GET",url:"/apis/QrcodeCase/copyV2",data:{btn_id:e?e.id:r.previewShow.id,scene_id:i,preview:0,create_from:d,tmp_from:1,cfrom:getUrlPara("cfrom")||"1",scene_tag_id:n},dataType:"json",success:function(e){if(1==e.status){var t=a?e.data.edit_link+"&pageFrom="+a:e.data.edit_link;u&&"2"!==c&&"record"!==l&&"batch"!==l&&"editdesc"!==l&&"products"!==l?u.location.href=t:window.location.href=t,r.submiting=!1,r.submitingId=null,r.origin=null}else r.submitingId=null,r.origin=null,alert(e.info,"danger"),r.submiting=!1},error:function(){r.submitingId=null,r.origin=null,alert("网络错误，请稍后重试","danger"),r.submiting=!1}})},createBlankCode:function(e){account?window.open("//"+CONSOLE_DOMAIN+"/batch/infoview/"+e.codeId+"?isNewCode=1&fromCase=1"):seajs.use("//"+STATIC_SERVICE+"/js/login_plugin.js?v=20191223",function(t){t.login_plugin("login",0,function(){window.location.href="//"+CONSOLE_DOMAIN+"/batch/infoview/"+e.codeId+"?isNewCode=1&fromCase=1"})})},createExcelCode:function(){account?window.location.href="//"+CONSOLE_DOMAIN+"/batch/batchcode/addtemp?categoryId=0&fromCase=1":seajs.use("//"+STATIC_SERVICE+"/js/login_plugin.js?v=20191223",function(e){e.login_plugin("login",0,function(){window.location.href="//"+CONSOLE_DOMAIN+"/batch/batchcode/addtemp?categoryId=0&fromCase=1"},"batch")})},codeDesc:function(){this.statisticsDataWithComment(93,190321,"了解和活码的区别点击量")},buildBlank:function(e){e&&"disease"==e&&this.statisticsDataWithComment(1,112,"疾病防控 ———— 空白新建");var t=getUrlPara("type"),i=getUrlPara("clickfrom");switch(this.qrType){case"nencao":var a=getUrlPara("cfrom"),i=getUrlPara("clickfrom");this.statisticsDataWithComment("2"==a?167:93,9999,"新版活码空白模板"),"2"==a?window.location.href="//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from=57":"building"==getUrlPara("tab_type")?window.open("//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from=80"):"electricity"==getUrlPara("tab_type")?window.open("//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from=81"):getUrlPara("classifyid")?window.open("//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from="+getUrlPara("create_from")):"editdesc"===i?window.location.href="//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from=84":"products"===i?window.location.href="//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from=68":a&&"1"===a?("record"!==t||"batch"!==t)&&(window.location.href="//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from=22"):window.open("//"+CONSOLE_DOMAIN+"/edit?pre_from=newcode&pageFrom=blank&create_from=22");break;case"batch":if(this.buildBlankSceneItem)this.confirmUse(this.buildBlankSceneItem,"common",this.buildBlankSceneItem.scene_id,"blankBuild");else{var a=getUrlPara("cfrom"),i=getUrlPara("clickfrom");"index"===i?window.open("//"+CONSOLE_DOMAIN+"/edit?isNewCode=1&pageFrom=blankBuild&pre_from=newcode&create_from=33"):"2"==a||"record"!==t||"batch"!==t?window.location.href="//"+CONSOLE_DOMAIN+"/edit?isNewCode=1&pageFrom=blankBuild&pre_from=newcode":window.open("//"+CONSOLE_DOMAIN+"/edit?isNewCode=1&pageFrom=blankBuild&pre_from=newcode&create_from=23")}this.statisticsDataWithComment(93,314399,"批量二维码空白模板");break;case"record":this.statisticsDataWithComment(93,314401,"记录单空白模板"),"2"==a||"record"!==t||"batch"!==t?window.location.href="//"+CONSOLE_DOMAIN+"/edit?pageFrom=blankRecord&create_from=30":window.open("//"+CONSOLE_DOMAIN+"/edit?pageFrom=blankRecord&create_from=30")}},excelBuild:function(e){switch(this.qrType){case"batch":if($(e.target).closest(".batch_excel_desc_tip")[0]||$(e.target).closest(".excel_desc_icon")[0])break;window.location.href.indexOf("cli.im")>-1||window.location.href.indexOf("cliim.com")>-1?(this.createExcelCode(),this.statisticsDataWithComment(93,1004889,"批量二维码Excel")):(this.createExcelCode(),this.statisticsDataWithComment(93,965325,"批量二维码Excel"));break;case"product":}},needContact:function(){},qrcodeMakeGuide:function(e){this.statisticsDataWithComment(96,e.scene_id,e.index_title)},needLoginClick:function(e,t){return this.statisticsDataWithComment(92,t.index,t.text),t.needLogin&&!account?(e.preventDefault(),seajs.use("//"+STATIC_SERVICE+"/js/login_plugin.js?v=20191223",function(e){e.login_plugin("login",0,function(){window.location.href=t.url})}),!1):!0},statisticsDataWithComment:function(e,t,i){$.ajax({async:!0,type:"GET",url:"/Api/ClickLog/click",data:{fir:e,sec:t,comment:i},dataType:"jsonp",jsonp:"callback"})},openAsk:function(){window.open("https://cli.im/help/48187")},viewHBatchHelp:function(e){e.stopPropagation(),StatisticsData(91,10),window.open("https://cli.im/help/48804")},pageLog:function(){var e=this.cfrom,t=this.qrType;if(2==e&&"imgtext"!==t)return void this.statisticsDataWithComment(165,7);var i={nencao:1,batch:2,record:3,imgtext:4},a=i[t]||i.nencao;this.statisticsDataWithComment(165,a)}}});