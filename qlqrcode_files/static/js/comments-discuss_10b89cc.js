!function(t){function e(){var t=window.location;return/text/.test(t)?"TEXT":/url/.test(t)?"URL":/files/.test(t)?"FILES":/img/.test(t)?"IMG":/multimedia/.test(t)?"MULTIMEDIA":/mina/.test(t)?"MINA":/record/.test(t)?"RECORD":/batch/.test(t)?"BATCH":/qrblank/.test(t)?"QRBLANK":/vcard/.test(t)?"VCARD":/weixin/.test(t)?"WEIXIN":"TEXT"}function i(){var t=window.location.pathname;return t.indexOf("/text")>-1?"text":t.indexOf("/url")>-1?"url":t.indexOf("/files")>-1?"files":t.indexOf("/img")>-1?"img":t.indexOf("/multimedia")>-1?"multimedia":t.indexOf("/batch")>-1?"batch":t.indexOf("/qrblank")>-1?"qrblank":t.indexOf("/vcard")>-1?"vcard":t.indexOf("/record")>-1?"record":t.indexOf("/weixin")>-1?"weixin":t.indexOf("/mina")>-1?"mina":"text"}var n={},a="<div comment-box class='comment-box m-t-lg'><div discuss-title class='discuss-title none'>我要提问</div><span discuss-desc class='comment_none' style='display:inline-block;margin-bottom: 16px;color: #999;'>描述精准的问题，更易得到解答，我们会在工作时间内尽快回复</span><div desc-wrap class='comment-box-wrap'><div comment-box-close class='comment-box-close none'><i class='remove-comment-box'>×</i></div><div class='textarea-wrap' id='textarea-box'><textarea text-content id='text-content' class='main-text b-a text-content' name='text' placeholder='请输入文字内容'></textarea></div></div><div img-box class='img-box'><div id='wait' class='wait item' style='opacity: 0;display:none;'><img src='https://static.clewm.net/cli/images/cli-loading@2x.gif' alt='' /></div></div><div file-box class='file-box'><div uploading-file id='uploading' class='uploading-file none'><span data-filename><i class='fa fa-paperclip'></i> 我是文件名哦</span><div class='progress progress-xxs'><div class='progress-bar green' style='width: 0%'>0%</div></div></div><div class='wordcount-box' style='color:#999;'><span class='cur-words'>0</span>/200字</div></div><div class='desc-btn'><div class='annex-box inline'><div class='inline upload-annex-box'><input type='file' filedatacode-test class='btn uploadfile annex-btn-input' uptype='files' name='Filedata' ><span class='upload-annex-tip'><i class='fa fa-paperclip'></i> 上传附件</span></div><span annex-tip class='annex-tip m-l-sm'><span login-btn class='text-blue link'>登录</span>后，才能上传附件</span></div><div style='float:right;'><span content-empty class='content-empty none'>内容不许为空</span><button submit-btn class='btn green submit-btn' data-loading-text='提交中...'>提交</button></div></div></div>",o=function(t){t=t||{},this.options=t,this.options.pid_submit="modal"==this.options.pid_from?9999:this.options.pid,this.BtnSuccess=t.submitSuccess||function(){},this.BtnFail=t.submitFail||function(){},this.addBox(t)};o.prototype={constructor:o,addBox:function(t){if(t){var e=$(a),i=$(e.prop("outerHTML"));if(t.el){t.pid||(t.pid=0),t.pid_from||(t.pid_from="not_modal"),t.topic_id||(t.topic_id=0),"modal"==t.pid_from&&(i.find("[discuss-title]").attr("style","margin-bottom:4px;"),i.find("[discuss-desc]").removeClass("comment_none"),i.find("[submit-btn]").addClass("none"),i.find("[content-empty]").css("marginRight","0px")),"footer"==t.pid_from&&i.find("[submit-btn]").addClass("none"),0==t.pid?("modal"==t.pid_from?i.find("[text-content]").attr("text-content","9999"):i.find("[text-content]").attr("text-content",t.pid),i.find("[discuss-title]").removeClass("none"),i.find("[filedatacode-test]").attr("submit-btn-footer","")):(i.find("[submit-btn]").text("回复"),i.find("[text-content]").attr("text-content",t.pid),i.find("[submit-btn]").attr("data-loading-text","回复中...")),1==t.cancel&&i.find("[comment-box-close]").removeClass("none"),t.marginTop&&(i.find("[desc-wrap]").parent().removeClass("m-t-lg"),i.find("[desc-wrap]").parent().css("marginTop",t.marginTop));var n=$("#"+t.el);"modal"==t.pid_from?(i.find("[desc-wrap]").parent().attr("submit_box_id",9999),i.find("[submit-btn]").attr("data-pid",9999),i.find("[filedatacode-test]").attr("data-pid",9999)):(i.find("[desc-wrap]").parent().attr("submit_box_id",t.pid),i.find("[submit-btn]").attr("data-pid",t.pid),i.find("[filedatacode-test]").attr("data-pid",t.pid)),i.find("[submit-btn]").attr("data-topic-pid",t.topic_id),n.append(i[0].outerHTML),""==account||$("[annex-tip]").html("").text("支持上传图片、Word、PPT、Excel文件格式，文件上传上限为3个"),this.bindEvent(),t.placeholderContent&&(t.pid?"modal"!=t.pid_from?$("[submit_box_id="+t.pid+"]").find("[text-content]").attr("placeholder",t.placeholderContent):$("[submit_box_id=9999]").find("[text-content]").attr("placeholder",t.placeholderContent):$("[text-content]").attr("placeholder",t.placeholderContent))}}},bindEvent:function(){var t=this;$("[submit-btn][data-pid="+this.options.pid_submit+"]").off("click").on("click",function(){var e=$(this).attr("data-pid"),i=$(this).attr("data-topic-pid"),n=$("[text-content="+e+"]").val();if(!n&&"footer"!=t.options.pid_from)return $("[submit_box_id="+e+"]").find("[content-empty]").show(),!1;if($(this).button("loading"),n.length>200)return alert("超过了200字"),$(this).button("reset"),!1;var a=$("[file-info]"),d=[];a.each(function(t,e){var e=$(e),i={};i.path=e.attr("file-path"),i.name=e.attr("file-name"),i.size=e.attr("file-size"),i["size-byte"]=e.attr("file-size-byte"),d.push(i)});var l=o.prototype.checkLoginV2.call(this,"submit_btn",t);return 0==l?($(this).button("reset"),!1):(s.getFilesData(e),void($(this).attr("data-pid")==e&&(9999==e&&(e=0),o.prototype.submitComments.call(this,n,i,d,e,t))))})},submitComments:function(t,i,a,o,d){var l=this,c="",r="";if("modal"==d.options.pid_from||"footer"==d.options.pid_from)var c=$('[name="receiveMethod"]:checked').val(),r=$("#email").val();n.content||s.getFilesData(o),$.ajax({type:"post",url:"/comment/publish",data:{content:t,topic_id:$("#topicId").val()||0,attchments:a,pid:o,email:"email"==c?r:""},dataType:"json",async:!0,success:function(t){var i=$(l).attr("data-pid"),a=window.parent.location;if(/comment/.test(a))alert(0==i||9999==i?"提交成功":"回复成功");else{var o=e();if("TEXT"==o||"URL"==o||"FILES"==o||"IMG"==o||"MULTIMEDIA"==o||"MINA"==o||"RECORD"==o||"BATCH"==o||"QRBLANK"==o||"VCARD"==o||"WEIXIN"==o){var s=t.data&&t.data.comment_id,c=$("#comment-tab-item"),r="";c.length>0&&(r=c.attr("href")),r=r&&r.indexOf("?")>-1?r+"&comment_id="+s:r+"?comment_id="+s,c.length>0?window.location.href=r:alert("提交成功，请到问答区查看")}else alert("提交成功，请到问答区查看")}d.BtnSuccess.call(this,t,n,i)},error:function(){d.Btnfail.call(this)}})},checkLoginV2:function(t,e){return""==account?(seajs.use("//"+STATIC_SERVICE+"/js/login_plugin.js?v=20190610",function(i){i.login_plugin("login","",function(){$("#iframe").hide(),$("#login_join",window.parent.document).hide(),$("#close_login",window.parent.document).hide(),$("body",window.parent.document).removeClass("modal-active"),$("#login",window.parent.document).hide(),$("#myqr_out",window.parent.document).show(),$("[annex-tip]").html("").text("支持上传图片、Word、PPT、Excel文件格式，文件上传上限为3个"),"login_btn"!=t&&"upload_btn"!=t&&e&&o.prototype.LoginCallback.call(this,e);var i=Number($("#isAdmin").val())||0,n=1==i?'<a href="?type=check">未审核</a>\n<a class="active" href="?">已审核</a>\n<a href="?type=all">全部</a>\n<a href="?type=me">我</a>\n':'<a class="active" href="?type=all">全部</a>\n<a href="?type=me">我</a>\n';return $(".comments-stats").html(n),!0},1,"")}),!1):!0},LoginCallback:function(t){var e=$("[submit-btn]").attr("data-pid"),i=$("[text-content="+e+"]").val(),n=$("[file-info]"),a=[];n.each(function(t,e){var e=$(e),i={};i.path=e.attr("file-path"),i.name=e.attr("file-name"),i.size=e.attr("file-size"),i["size-byte"]=e.attr("file-size-byte"),a.push(i)}),o.prototype.submitComments.call(this,i,1,a,e,t)}};var s={getSuffix:function(t){var e=/[^\.]+$/.exec(t);return e},contentLengthTip:function(){var t=$("[submit-btn]").attr("data-pid"),e=$("[text-content="+t+"]").val(),i=e.length;i>200&&alert("超过了200字")},getFilesData:function(t){var e=$("[text-content="+t+"]").val();if(!e)return $("[submit_box_id="+t+"]").find("[content-empty]").show(),!1;var i=[],a=[],o=$("[img-render]"),s=$("[file-render]");o.each(function(t,e){var e=$(e),n={};n.path=e.attr("file-path"),n.name=e.attr("file-name"),n.size=e.attr("file-size"),n["size-byte"]=e.attr("file-size-byte"),i.push(n)}),s.each(function(t,e){var e=$(e),i={};i.path=e.attr("file-path"),i.name=e.attr("file-name"),i.size=e.attr("file-size"),i["size-byte"]=e.attr("file-size-byte"),a.push(i)}),n.content=e,n.img_lists=i,n.file_lists=a}};$(document).on("click","[comment-box-close]",function(t){t.stopPropagation(),$(this).parent().parent().remove()}),$(document).on("click","[login-btn]",function(){o.prototype.checkLoginV2.call(this,"login_btn")}),$(document).on("click","[remove-close]",function(t){t.stopPropagation(),1==$(this).parent().parent().find("[file-info]").length&&$("#wait").hide();var e=$("[file-tag]").length;3>=e&&($(this).parent().parent().parent().find("[filedatacode-test]").attr("disabled",!1),$(this).parent().parent().parent().find("[filedatacode-test]").css("cursor","pointer"),$(this).parent().parent().parent().find("[filedatacode-test]").parent().css("backgroundColor","#fff")),$(this).parent().remove()}),$(document).on("click","[delete-file]",function(t){t.stopPropagation();var e=$("[file-tag]").length;3>=e&&($(this).parent().parent().parent().find("[filedatacode-test]").attr("disabled",!1),$(this).parent().parent().parent().find("[filedatacode-test]").css("cursor","pointer"),$(this).parent().parent().parent().find("[filedatacode-test]").parent().css("backgroundColor","#fff")),$(this).parent().remove()}),$(document).on("keydown","[text-content]",function(){var t=$(this).attr("text-content"),e=$("[text-content="+t+"]").val().length;0!==e&&$("[submit_box_id="+t+"]").find(".wordcount-box").show(),$("[submit_box_id="+t+"]").find(".cur-words").find("").html(e)}),$(document).on("keyup","[text-content]",function(){var t=$(this).attr("text-content"),e=$("[text-content="+t+"]").val().length;$("[submit_box_id="+t+"]").find(".cur-words").html(e),s.contentLengthTip()}),$(function(){$(document).on("click","[img-box],[file-box]",function(){var t=$("[submit-btn]").attr("data-pid");$("[text-content="+t+"]").focus()}),$(document).on("focus","textarea",function(){$("[content-empty]").hide()}),$(document).on("focus","[submit_box_id=0] [text-content]",function(){$(".reply-box").html(""),new_first_file_upload=!1,$(this).parent().parent().parent().find("input").replaceWith("<input type='file' filedatacode-test-footer filedatacode-test class='btn uploadfile annex-btn-input' uptype='files' name='Filedata' data-pid='0' >"),$(document).off("click","[submit-btn]")})}),$(document).on("change","[submit-btn-footer], [filedatacode-test], [filedatacode-test-footer], [filedatacode-test-modal]",function(){var t=$(this).attr("data-pid"),e=i(),n=o.prototype.checkLoginV2.call(this,"upload_btn");if(0==n)return alert("请先登录"),!1;var a=this.files[0];if(!a)return!1;var d=s.getSuffix(a.name),l=d[0].toLowerCase();$("#file-name").val(l),"jpg"==l||"jpg"==l||"jpeg"==l||"gif"==l||"png"==l||"bmp"==l?($("[submit_box_id="+t+"]").find("#wait").show(),$("[submit_box_id="+t+"]").find("#wait").css("opacity","1")):("pptx"==l||"pdf"==l||"doc"==l||"docx"==l||"ppt"==l||"xls"==l||"xlsx"==l)&&($("[submit_box_id="+t+"]").find("[uploading-file]").find("[data-filename]").text(a.name),$("[submit_box_id="+t+"]").find("[uploading-file]").show()),1==isUrl?upload_v2("comments",file_size,l,t):2==isUrl?upload("comments",file_size,l,t):3==isUrl&&("text"==e||"url"==e)&&upload_v3("comments",file_size,l,t)}),t.commentsBox=o}(this);